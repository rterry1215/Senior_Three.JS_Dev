(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b():"function"==typeof define&&define.amd?define(b):b()})(this,function(){'use strict';var a=function(){this.pingMsg=new Float32Array(1),this.pingTransferable=new Float32Array(2),this.pingTransferableList=[this.pingTransferable.buffer],this.hasPingTransferableOwnership=!0,this.intermediateBuffers={},this.transferableList=[],this.transferables={},this.reusableArray=[]};a.prototype.sendPing=function(){b.isSocketClosed||(b.ws.send(b.pingMsg.buffer),b.lastPingSendTime=performance.now())},a.prototype.onWSOpen=function(){b.isSocketClosed=!1,postMessage({isConnected:!0}),setTimeout(this.sendPing,3e3)},a.prototype.onWSMessage=function(a){var c=new Float32Array(a.data),d=c[0];if(0!=d)b.reusableArray[0]=c.buffer,postMessage(c,b.reusableArray);else if(setTimeout(b.sendPing,3e3),b.hasPingTransferableOwnership){var e=performance.now()-b.lastPingSendTime;b.pingTransferable[0]=-2,b.pingTransferable[1]=e,postMessage(b.pingTransferable,b.pingTransferableList),b.hasPingTransferableOwnership=!1}},a.prototype.onWSClose=function(){b.isSocketClosed=!0,postMessage({isDisconnected:!0})},a.prototype.onWSError=function(){postMessage({isError:!0})},a.prototype.connect=function(a){var b=new WebSocket(a);b.onopen=this.onWSOpen.bind(this),b.onmessage=this.onWSMessage.bind(this),b.onclose=this.onWSClose.bind(this),b.onerror=this.onWSError.bind(this),b.binaryType="arraybuffer",this.ws=b};var b=new a;self.onmessage=function(a){var c=a.data;if(c.serverURL)b.connect(c.serverURL);else{if(-2==c[0])return b.pingTransferable=c,b.pingTransferableList[0]=c.buffer,void(b.hasPingTransferableOwnership=!0);if(b.isSocketClosed)return;var d=c.length,e=b.intermediateBuffers[d];e||(e=new Float32Array(d),b.intermediateBuffers[d]=e);for(var f=0;f<c.length;f++)e[f]=c[f];b.transferableList[0]=c.buffer,postMessage(c,b.transferableList),b.ws.send(e.buffer)}}});